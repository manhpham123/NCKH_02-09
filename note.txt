1, ở máy client 
- file cấu hình : sudo gedit /etc/evebox/agent.yaml 
+ sửa :
  server:
  url: http://192.168.189.128:5636   # thay vào ip của evebox server
- chạy để gửi log từ eve.json client lên sqlite của server : evebox agent -c /etc/evebox/agent.yaml
=> để thuân tiện thì ở máy client đã chạy tất cả lệnh vào 1 file .sh, vào thư mục Documents/Monitor và chạy file .sh này
~/Documents/Monitor$ ./monitor.sh 
2, máy server
- Chạy: 
+ sudo systemctl start evebox
+ sudo systemctl status evebox
+ sudo systemctl enable evebox
- xem : http://localhost:5636  hoặc  http://(ip của máy server trên 1 card mạng nào đó, vd ơ đây là card ens33)192.168.189.128:5636
- Sql lite:
+ đường dẫn đến thư muc lưu trữ:
sudo su
cd /var/lib/evebox/
+ file lưu trữ là : events.sqlite
+ sudo du -sh /var/lib/evebox/events.sqlite: kiểm tra dung lượng cụ thể của file
+ xem cơ sở dữ liệu:  cài đặt SQLite DB Browse
Mở DB Browser for SQLite với Quyền root sau đơ mở file events.sqlite:
sudo sqlitebrowser /var/lib/evebox/events.sqlite

+ Xóa file csdl: Để xóa file /var/lib/evebox/events.sqlite lúc ấy evebox server ko còn gì để hiện thị cả
  Dừng dịch vụ EveBox: sudo systemctl stop evebox
 Kiểm tra trạng thái: sudo systemctl status evebox
 xóa : sudo rm /var/lib/evebox/events.sqlite
 Khởi động lại dịch vụ EveBox: sudo systemctl start evebox

- để gửi log từ evebox lên mongodb
+ truy cập thư mục ~/Documents/sendlog_to_mongodb
+ câp quyền cho evebox:   sudo chmod 777 /var/lib/evebox  và    sudo chmod 777 /var/lib/evebox/events.sqlite  
+ chạy : frblam@frblam-virtual-machine:~/Documents/sendlog_to_mongodb$ python3 send_log.py
+ csdl: log_json
+ bảng: full_log

- lưu trữ csdl của hash file, vào thư mục trên : ~/Documents/check_hash$

====
Thao tác với suricata ở máy client
- file cấu hình : sudo gedit /etc/suricata/suricata.yaml
+ Sửa biến HOME_NET
+ Tùy chính file rule: 
rule-files:
#  - suricata.rules
  - local.rules
+ sửa interface: card mạng theo dõi
+ rule tự viết: sudo gedit /var/lib/suricata/rules/local.rules
+ rule sẵn: sudo gedit /var/lib/suricata/rules/suricata.rules
+ tao rule co san: sudo suricata-update
+ Thư mục lưu trữ Rule : cd /var/lib/suricata/rules
+ Đổi tên file rule mặc định : mv suricata.rules custom.rules
+ Lên mogodb tạo 1 file có tên : custom.rules
- kiêm tra file câu hình:  sudo suricata -T -c /etc/suricata/suricata.yaml -v
- chạy suricata:  sudo suricata -c /etc/suricata/suricata.yaml -i ens33 
- xem log trực tiếp: sudo tail -f /var/log/suricata/fast.log
- file log eve.json : sudo gedit /var/log/suricata/eve.json   
- xóa file eve.json : sudo truncate -s 0 /var/log/suricata/eve.json
sudo systemctl start suricata.service
sudo systemctl status suricata.service
sudo systemctl stop suricata.service
sudo systemctl restart suricata.service

- test tải file: 192.168.189.128/downloads/yourfile.txt  , bao gồm test mã hash và alert
- trong thư mục Documents của máy client có file:  suricata.rules

=========
- ở máy server tạo bảng "hash_md5" trong csdl "hash_malware"

============================ 1 số rule test
alert icmp any any -> $HOME_NET any (msg:"co nguoi dang ping"; sid:10000001;)   : rule ping
alert http any any -> any any (msg:"dang tai file"; sid:10000001;)               : rule tải file

===========
** ở máy attacker:
- vào thư mục : /home/kali/Documents/Download , thư mục này có 2 file mã độc
    + Tại thư mục này chạy lệnh : sudo python3 -m http.server 80
    + vào trình duyệt máy client gõ : http://192.168.10.5/demo.exe  và  http://192.168.10.5/example.dll  để tải file mã độc về
- Tắt bảo vệ của chrome: chrome://settings/security -> no protection
- sudo cp /home/kali/Documents/malware/demo.exe /var/www/html/downloads
- sudo cp /home/kali/Documents/malware/example.dll /var/www/html/downloads  
